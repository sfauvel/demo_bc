!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";e.exports=n(1)},function(e,t,n){"use strict";
/** @license React v16.5.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=n(2),a="function"==typeof Symbol&&Symbol.for,o=a?Symbol.for("react.element"):60103,l=a?Symbol.for("react.portal"):60106,i=a?Symbol.for("react.fragment"):60107,s=a?Symbol.for("react.strict_mode"):60108,c=a?Symbol.for("react.profiler"):60114,u=a?Symbol.for("react.provider"):60109,d=a?Symbol.for("react.context"):60110,h=a?Symbol.for("react.async_mode"):60111,f=a?Symbol.for("react.forward_ref"):60112;a&&Symbol.for("react.placeholder");var p="function"==typeof Symbol&&Symbol.iterator;function m(e){for(var t=arguments.length-1,n="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=0;r<t;r++)n+="&args[]="+encodeURIComponent(arguments[r+1]);!function(e,t,n,r,a,o,l,i){if(!e){if(e=void 0,void 0===t)e=Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var s=[n,r,a,o,l,i],c=0;(e=Error(t.replace(/%s/g,function(){return s[c++]}))).name="Invariant Violation"}throw e.framesToPop=1,e}}(!1,"Minified React error #"+e+"; visit %s for the full message or use the non-minified dev environment for full errors and additional helpful warnings. ",n)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y={};function v(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||b}function k(){}function g(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||b}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){"object"!=typeof e&&"function"!=typeof e&&null!=e&&m("85"),this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},k.prototype=v.prototype;var E=g.prototype=new k;E.constructor=g,r(E,v.prototype),E.isPureReactComponent=!0;var S={current:null,currentDispatcher:null},C=Object.prototype.hasOwnProperty,x={key:!0,ref:!0,__self:!0,__source:!0};function O(e,t,n){var r=void 0,a={},l=null,i=null;if(null!=t)for(r in void 0!==t.ref&&(i=t.ref),void 0!==t.key&&(l=""+t.key),t)C.call(t,r)&&!x.hasOwnProperty(r)&&(a[r]=t[r]);var s=arguments.length-2;if(1===s)a.children=n;else if(1<s){for(var c=Array(s),u=0;u<s;u++)c[u]=arguments[u+2];a.children=c}if(e&&e.defaultProps)for(r in s=e.defaultProps)void 0===a[r]&&(a[r]=s[r]);return{$$typeof:o,type:e,key:l,ref:i,props:a,_owner:S.current}}function j(e){return"object"==typeof e&&null!==e&&e.$$typeof===o}var _=/\/+/g,B=[];function w(e,t,n,r){if(B.length){var a=B.pop();return a.result=e,a.keyPrefix=t,a.func=n,a.context=r,a.count=0,a}return{result:e,keyPrefix:t,func:n,context:r,count:0}}function P(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>B.length&&B.push(e)}function I(e,t,n){return null==e?0:function e(t,n,r,a){var i=typeof t;"undefined"!==i&&"boolean"!==i||(t=null);var s=!1;if(null===t)s=!0;else switch(i){case"string":case"number":s=!0;break;case"object":switch(t.$$typeof){case o:case l:s=!0}}if(s)return r(a,t,""===n?"."+N(t,0):n),1;if(s=0,n=""===n?".":n+":",Array.isArray(t))for(var c=0;c<t.length;c++){var u=n+N(i=t[c],c);s+=e(i,u,r,a)}else if(u=null===t||"object"!=typeof t?null:"function"==typeof(u=p&&t[p]||t["@@iterator"])?u:null,"function"==typeof u)for(t=u.call(t),c=0;!(i=t.next()).done;)s+=e(i=i.value,u=n+N(i,c++),r,a);else"object"===i&&m("31","[object Object]"==(r=""+t)?"object with keys {"+Object.keys(t).join(", ")+"}":r,"");return s}(e,"",t,n)}function N(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,function(e){return t[e]})}(e.key):t.toString(36)}function T(e,t){e.func.call(e.context,t,e.count++)}function $(e,t,n){var r=e.result,a=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?A(e,r,n,function(e){return e}):null!=e&&(j(e)&&(e=function(e,t){return{$$typeof:o,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,a+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(_,"$&/")+"/")+n)),r.push(e))}function A(e,t,n,r,a){var o="";null!=n&&(o=(""+n).replace(_,"$&/")+"/"),I(e,$,t=w(t,o,r,a)),P(t)}var M={Children:{map:function(e,t,n){if(null==e)return e;var r=[];return A(e,r,null,t,n),r},forEach:function(e,t,n){if(null==e)return e;I(e,T,t=w(null,null,t,n)),P(t)},count:function(e){return I(e,function(){return null},null)},toArray:function(e){var t=[];return A(e,t,null,function(e){return e}),t},only:function(e){return j(e)||m("143"),e}},createRef:function(){return{current:null}},Component:v,PureComponent:g,createContext:function(e,t){return void 0===t&&(t=null),(e={$$typeof:d,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,Provider:null,Consumer:null,unstable_read:null}).Provider={$$typeof:u,_context:e},e.Consumer=e,e.unstable_read=function(e,t){var n=S.currentDispatcher;return null===n&&m("277"),n.readContext(e,t)}.bind(null,e),e},forwardRef:function(e){return{$$typeof:f,render:e}},Fragment:i,StrictMode:s,unstable_AsyncMode:h,unstable_Profiler:c,createElement:O,cloneElement:function(e,t,n){(null===e||void 0===e)&&m("267",e);var a=void 0,l=r({},e.props),i=e.key,s=e.ref,c=e._owner;if(null!=t){void 0!==t.ref&&(s=t.ref,c=S.current),void 0!==t.key&&(i=""+t.key);var u=void 0;for(a in e.type&&e.type.defaultProps&&(u=e.type.defaultProps),t)C.call(t,a)&&!x.hasOwnProperty(a)&&(l[a]=void 0===t[a]&&void 0!==u?u[a]:t[a])}if(1===(a=arguments.length-2))l.children=n;else if(1<a){u=Array(a);for(var d=0;d<a;d++)u[d]=arguments[d+2];l.children=u}return{$$typeof:o,type:e.type,key:i,ref:s,props:l,_owner:c}},createFactory:function(e){var t=O.bind(null,e);return t.type=e,t},isValidElement:j,version:"16.5.2",__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentOwner:S,assign:r}},L={default:M},R=L&&M||L;e.exports=R.default||R},function(e,t,n){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,l,i=function(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),s=1;s<arguments.length;s++){for(var c in n=Object(arguments[s]))a.call(n,c)&&(i[c]=n[c]);if(r){l=r(n);for(var u=0;u<l.length;u++)o.call(n,l[u])&&(i[l[u]]=n[l[u]])}}return i}},function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r);const o=e=>e,l=e=>{if(0===Object.keys(e).length||"0"===Object.keys(e)[0])return e;const t={};return Object.keys(e).sort().forEach(function(n){t[n]=l(e[n])}),t},i=e=>{const t=l(JSON.parse(e));console.log(t);let n=JSON.stringify(t);var r,a=0;if(0===n.length)return a;for(r=0;r<n.length;r++)a=(a<<5)-a+n.charCodeAt(r),a|=0;return a};class s extends a.a.Component{constructor(e){super(e)}render(){const e=this.props.tx.x>this.props.tx.y,t="transaction"+(this.props.selected?" selected":"")+(e?" valid":" invalid"),n=o(this.props.tx.id)+" - "+this.props.tx.user+" "+this.props.tx.x+"/"+this.props.tx.y;return a.a.createElement("div",null,a.a.createElement("label",{onClick:this.props.handler,className:t},n,a.a.createElement("span",{className:e?"validTx":"invalidTx"},"!")))}}class c extends a.a.Component{render(){const e=this.props.block,t=this.props.branch-1,n="block"+(this.props.selected?" selected":"")+(this.props.inChain?" inChain":""),r={marginLeft:3*t+"em"};return a.a.createElement("div",{className:n,style:r,onClick:this.props.handler},a.a.createElement("div",{className:"blockInfo"},o(e.id)," ... ",o(e.parentId)),a.a.createElement("div",{className:"blockTransaction"},e.transactions.map(e=>a.a.createElement("div",{key:"tx_"+e.id},a.a.createElement(s,{tx:e})))))}}const u=5;class d extends a.a.Component{constructor(e){super(e),this.state={isLoaded:!1,proofOfWork:0,blocks:[],transactions:[],selectedBlock:void 0},this.handleChange=this.handleChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this)}handleChange(e){}handleProofOfWorkChange(e){this.setState({proofOfWork:e.target.value})}componentDidMount(){this.loadBlockchain()}loadBlockchain(){fetch("/bc/view").then(e=>e.json()).then(e=>{const t=this.buildBlocksMap(e.blocks);this.setState({isLoaded:!0,blocks:e.blocks.reverse(),blocksMap:t,transactions:e.transactions,checkedElements:new Set,selectedBlock:this.getHeadBlock(e.blocks,t)})})}buildBlocksMap(e){const t={};return e.forEach(function(e){t[e.id]=e}),t}buildResponse(){var e={proofOfWork:this.state.proofOfWork,parentId:this.state.selectedBlock,transactions:[]},t=this.state.checkedElements;return this.state.transactions.forEach(function(n){t.has(n.id)&&e.transactions.push(n)}),e}handleSubmit(e){e.preventDefault();var t=this.buildResponse();if(!t.parentId)return void alert("Select a parent block !");const n=JSON.stringify(t);0==parseInt(i(n))%u?(fetch("/bc/validate",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:n}),this.loadBlockchain()):alert("Try again !")}handleCheckedChange(e){var t=e.target.name;e.target.checked?this.state.checkedElements.add(t):this.state.checkedElements.delete(t)}isValidate(e){this.state.checkedElements;return this.state.checkedElements.has(e)}handlerTransactionSelection(e,t){var n=this.state.checkedElements;this.state.checkedElements.has(e)?n.delete(e):n.add(e),this.setState({checkedElements:n})}handlerBlockSelection(e,t){this.setState({selectedBlock:e})}handleFocus(e){e.target.select()}blockBranch(e){return 1}transactionsNotInABlock(){const e=this.state.blocksMap;let t=this.getBlockInSelectedChain(),n=new Set;t.forEach(function(t){e[t].transactions.forEach(function(e){n.add(e.id)})});let r=[];return this.state.transactions.forEach(function(e){n.has(e.id)||r.push(e)}),r}getHeadBlock(e=this.state.blocks,t=this.state.blocksMap){let n=new Set;e.forEach(function(e){n.add(e.parentId)});let r=[],a=this.getBlockInChain;e.forEach(function(e){n.has(e.id)||r.push([e.id,a(e.id,t).size])});let o,l=0;return r.forEach(function(e){e[1]>l&&(l=e[1],o=e[0])}),o}getBlockInSelectedChain(){return this.getBlockInChain(this.state.selectedBlock,this.state.blocksMap)}getBlockInChain(e,t){let n=t[""+e],r=new Set;for(;n&&0!=n.id;)r.add(n.id),n=t[n.parentId];return r}isBlockInSelectedChain(e){return this.getBlockInSelectedChain().has(e.id)}render(){const{isLoaded:e,blocks:t,transactions:n}=this.state;return e?a.a.createElement("div",{className:"content"},a.a.createElement("form",{onSubmit:this.handleSubmit},a.a.createElement("div",null,a.a.createElement("div",{id:"labelProof"},"Proof of work"),a.a.createElement("input",{id:"proofOfWork",type:"text",value:this.state.proofOfWork,onChange:this.handleProofOfWorkChange.bind(this),onFocus:this.handleFocus}),a.a.createElement("input",{type:"submit",className:"button",value:"Submit"})),a.a.createElement("div",null,this.transactionsNotInABlock().map(e=>a.a.createElement("div",{key:"txcheck_"+e.id},a.a.createElement(s,{tx:e,selected:this.isValidate(e.id),handler:t=>this.handlerTransactionSelection(e.id,t)})))),a.a.createElement("div",null,t.map(e=>a.a.createElement("div",{key:"bck_"+e.id},a.a.createElement(c,{block:e,branch:this.blockBranch(e),selected:this.state.selectedBlock===e.id,inChain:this.isBlockInSelectedChain(e),handler:t=>this.handlerBlockSelection(e.id,t)})))))):a.a.createElement("div",null,"Loading...")}}class h extends a.a.Component{constructor(e){super(e),this.state={id:"0",user:"",x:"",y:""},this.handleChange=this.handleChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this)}handleChange(e){this.setState({[e.target.name]:e.target.value})}handleSubmit(e){e.preventDefault(),fetch("/tx/add",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(this.state)})}render(){return a.a.createElement("div",{className:"content"},a.a.createElement("form",{id:"addTxForm",onSubmit:this.handleSubmit},a.a.createElement("div",null,a.a.createElement("div",null,a.a.createElement("label",null,"Name")),a.a.createElement("input",{size:"15",name:"user",placeholder:"User",type:"text",value:this.state.user,onChange:this.handleChange})),a.a.createElement("div",null,a.a.createElement("div",null,a.a.createElement("label",null,"X")),a.a.createElement("input",{size:"15",name:"x",placeholder:"X",type:"text",value:this.state.x,onChange:this.handleChange})),a.a.createElement("div",null,a.a.createElement("div",null,a.a.createElement("label",null,"Y")),a.a.createElement("input",{size:"15",name:"y",placeholder:"Y",type:"text",value:this.state.y,onChange:this.handleChange})),a.a.createElement("div",null,a.a.createElement("input",{type:"submit",className:"button",value:"Submit"}))))}}class f extends a.a.Component{render(){return a.a.createElement("div",{className:"about"},a.a.createElement("h2",null,"Blockchain"),a.a.createElement("p",null,"L'utilisateur soumet des transactions en indiquant un nom et des coordonnees X et Y. La valeur X doit etre superieure a la valeur Y. L'application ne controle pas cette contrainte, ce sera le role des mineurs de le faire."),a.a.createElement("p",null,"Les mineurs visualisent la blockchain. Ils selectionnent le dernier bloc qu'il considere valide ainsi que les transactions qu'ils veulent inclure au prochain bloc. Pour les aider, un symbole '!' signale les transactions invalides (X inferieur ou egal a  Y) Le choix d'un bloc met en evidence la liste des blocs dont il est issue."),a.a.createElement("p",null,"Ils doivent egalement indiquer un chiffre avant de soumettre leur bloc. Les valeurs acceptable sont determinees par les donnees soumises mais elles ne sont pas predictible. Le mineur peut faire autant de tentatives qu'il souhaite jusqu'a trouver un valeur acceptable."))}}ReactDOM.render(a.a.createElement(class extends a.a.Component{constructor(e){super(e),this.state={onglet:"A"}}handleClick(e,t){this.setState({onglet:t})}render(){let e;return e="A"===this.state.onglet?a.a.createElement(d,null):"B"===this.state.onglet?a.a.createElement(h,null):a.a.createElement(f,null),a.a.createElement("div",null,a.a.createElement("div",{className:"bar"},a.a.createElement("a",{className:"baritem"+("A"===this.state.onglet?" selected":""),onClick:e=>this.handleClick(e,"A")},"Blockchain"),a.a.createElement("a",{className:"baritem"+("B"===this.state.onglet?" selected":""),onClick:e=>this.handleClick(e,"B")},"Transaction"),a.a.createElement("a",{className:"baritem about"+("C"===this.state.onglet?" selected":""),onClick:e=>this.handleClick(e,"C")},"?")),e)}},null),document.getElementById("root"))}]);